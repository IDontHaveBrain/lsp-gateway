# Go Repository LSP Validation Configuration
name: "Go Repository LSP Validation"
description: "Comprehensive LSP testing against real Go repositories"
timeout: 10m
parallel: true

servers:
  gopls:
    name: "gopls"
    language: "go"
    command: "gopls"
    transport: "stdio"
    start_timeout: 30s
    pre_warmup: true
    capabilities:
      - "textDocument/definition"
      - "textDocument/references"
      - "textDocument/hover"
      - "textDocument/documentSymbol"
      - "workspace/symbol"

repositories:
  - name: "golang-repo"
    path: "./tests/data/repositories/go/golang"
    language: "go"
    description: "Official Go repository"
    setup:
      commands:
        - "go mod tidy || true"
        - "go mod download || true"
      build_cmd: "go build ./cmd/..." 
      timeout: 5m
    test_cases:
      # Definition tests
      - id: "go_definition_main"
        name: "Go main function definition"
        method: "textDocument/definition"
        file: "src/cmd/go/main.go"
        position:
          line: 20
          character: 5
        expected:
          success: true
          definition:
            has_location: true
        tags: ["definition", "basic"]
        timeout: 30s

      # Reference tests  
      - id: "go_references_func"
        name: "Go function references"
        method: "textDocument/references"
        file: "src/go/build/build.go"
        position:
          line: 50
          character: 10
        params:
          includeDeclaration: true
        expected:
          success: true
          references:
            min_count: 1
        tags: ["references", "basic"]
        timeout: 45s

      # Hover tests
      - id: "go_hover_type"
        name: "Go type hover"
        method: "textDocument/hover"
        file: "src/go/types/types.go"
        position:
          line: 100
          character: 15
        expected:
          success: true
          hover:
            has_content: true
        tags: ["hover", "basic"]
        timeout: 30s

      # Document symbols
      - id: "go_document_symbols"
        name: "Go document symbols"
        method: "textDocument/documentSymbol"
        file: "src/go/build/build.go"
        expected:
          success: true
          symbols:
            min_count: 5
        tags: ["symbols", "basic"]
        timeout: 60s

      # Workspace symbols
      - id: "go_workspace_symbols"
        name: "Go workspace symbol search"
        method: "workspace/symbol"
        params:
          query: "main"
        expected:
          success: true
          symbols:
            min_count: 1
        tags: ["workspace", "symbols"]
        timeout: 120s

execution:
  max_concurrency: 2
  default_timeout: 60s
  retry_attempts: 2
  fail_fast: false

validation:
  strict_mode: false
  validate_types: true
  validate_positions: true
  validate_uris: true

reporting:
  formats: ["console", "json", "junit"]
  output_dir: "repo-validation-golang"
  verbose: true
  include_timing: true