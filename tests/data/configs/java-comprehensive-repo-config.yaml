# Enhanced Java Repository LSP Validation Configuration
# Comprehensive enterprise Java testing with Spring Boot 3.2+ and Apache Kafka 3.6+
# Fixed commit hashes for reproducible testing and performance validation

name: "Java Comprehensive Enterprise LSP Validation"
description: "Enterprise-grade LSP testing against Spring Boot and Apache Kafka with fixed commit hashes"
timeout: 25m
parallel: true
tags: ["java", "enterprise", "spring-boot", "kafka", "comprehensive"]

servers:
  jdtls:
    name: "eclipse-jdtls"
    language: "java"
    command: "jdtls"
    transport: "stdio"
    start_timeout: 90s
    shutdown_timeout: 20s
    pre_warmup: true
    initialize_delay: 8s
    capabilities:
      - "textDocument/definition"
      - "textDocument/references"
      - "textDocument/hover"
      - "textDocument/documentSymbol"
      - "workspace/symbol"
      - "textDocument/formatting"
      - "textDocument/codeAction"
    init_options:
      settings:
        java:
          home: "/usr/lib/jvm/java-17-openjdk"
          compile:
            nullAnalysis:
              mode: "automatic"
            importOrder: ["java", "javax", "org", "com"]
          completion:
            enabled: true
            maxResults: 100
            favoriteStaticMembers: 
              - "org.junit.jupiter.api.Assertions.*"
              - "org.springframework.test.web.servlet.request.MockMvcRequestBuilders.*"
              - "org.springframework.test.web.servlet.result.MockMvcResultMatchers.*"
          project:
            referencedLibraries: ["lib/**/*.jar"]
          runtimes:
            - name: "JavaSE-17"
              path: "/usr/lib/jvm/java-17-openjdk"
              default: true
          configuration:
            maven:
              userSettings: null
              globalSettings: null
            gradle:
              home: null
              version: null
              jvmArguments: null
              arguments: null
        maven:
          downloadSources: true
          downloadJavadoc: true
        gradle:
          downloadSources: true
          downloadJavadoc: true

repositories:
  # Spring Boot 3.2+ Enterprise Testing Repository
  - name: "spring-boot-enterprise"
    path: "./tests/data/repositories/java/spring-boot"
    language: "java"
    description: "Spring Boot 3.2+ framework repository with enterprise patterns"
    version_info:
      repository_url: "https://github.com/spring-projects/spring-boot.git"
      commit_hash: "9e0d818688ecfcef3e08a2bac7ff19b8df5b3fd8"  # Spring Boot 3.2.1 release
      branch: "3.2.x"
      tag: "v3.2.1"
    setup:
      commands:
        - "git fetch origin 3.2.x"
        - "git checkout 9e0d818688ecfcef3e08a2bac7ff19b8df5b3fd8"
        - "echo 'Building Spring Boot with comprehensive Java 17+ features...'"
        - "./gradlew :spring-boot-project:spring-boot:compileJava -x test --no-daemon"
        - "./gradlew :spring-boot-project:spring-boot-autoconfigure:compileJava -x test --no-daemon"
        - "./gradlew :spring-boot-project:spring-boot-actuator:compileJava -x test --no-daemon"
        - "./gradlew :spring-boot-project:spring-boot-web:compileJava -x test --no-daemon"
        - "./gradlew :spring-boot-project:spring-boot-test:compileJava -x test --no-daemon"
        - "./gradlew jar -x test --no-daemon || true"
      timeout: 18m
      env:
        JAVA_HOME: "/usr/lib/jvm/java-17-openjdk"
        GRADLE_OPTS: "-Xmx4096m -XX:MaxMetaspaceSize=1024m -XX:+UseG1GC"
        GRADLE_USER_HOME: "./gradle-cache"
    validation:
      required_files:
        - "build.gradle"
        - "spring-boot-project/spring-boot/src/main/java/org/springframework/boot/SpringApplication.java"
        - "spring-boot-project/spring-boot-autoconfigure/src/main/java/org/springframework/boot/autoconfigure/EnableAutoConfiguration.java"
        - "spring-boot-project/spring-boot-actuator/src/main/java/org/springframework/boot/actuate/endpoint/annotation/Endpoint.java"
        - "spring-boot-project/spring-boot-web/src/main/java/org/springframework/boot/web/embedded/tomcat/TomcatServletWebServerFactory.java"
    test_cases:
      # Advanced Definition Tests - Spring Boot Enterprise Patterns
      - id: "spring_def_auto_configuration"
        name: "Spring Boot AutoConfiguration Definition"
        method: "textDocument/definition"
        file: "spring-boot-project/spring-boot-autoconfigure/src/main/java/org/springframework/boot/autoconfigure/web/servlet/WebMvcAutoConfiguration.java"
        position:
          line: 85    # @Configuration annotation with advanced patterns
          character: 12
        expected:
          success: true
          definition:
            has_location: true
            file_pattern: "**/Configuration.java"
        tags: ["definition", "spring-boot", "auto-configuration", "enterprise"]
        timeout: 60s

      - id: "spring_def_conditional_annotation"
        name: "Spring Conditional Annotation Definition"
        method: "textDocument/definition"
        file: "spring-boot-project/spring-boot-autoconfigure/src/main/java/org/springframework/boot/autoconfigure/jdbc/DataSourceAutoConfiguration.java"
        position:
          line: 95    # @ConditionalOnClass annotation
          character: 25
        expected:
          success: true
          definition:
            has_location: true
            file_pattern: "**/ConditionalOnClass.java"
        tags: ["definition", "conditional", "annotations", "enterprise"]
        timeout: 55s

      - id: "spring_def_aspect_oriented_programming"
        name: "Spring AOP Aspect Definition"
        method: "textDocument/definition"
        file: "spring-boot-project/spring-boot/src/main/java/org/springframework/boot/context/event/ApplicationContextInitializedEvent.java"
        position:
          line: 45    # Spring event handling patterns
          character: 20
        expected:
          success: true
          definition:
            has_location: true
        tags: ["definition", "aop", "events", "enterprise"]
        timeout: 50s

      # Advanced Reference Tests - Enterprise Usage Patterns
      - id: "spring_ref_dependency_injection_complex"
        name: "Spring Complex Dependency Injection References"
        method: "textDocument/references"
        file: "spring-boot-project/spring-boot-autoconfigure/src/main/java/org/springframework/boot/autoconfigure/web/servlet/WebMvcConfigurer.java"
        position:
          line: 60    # WebMvcConfigurer interface
          character: 15
        params:
          includeDeclaration: true
        expected:
          success: true
          references:
            min_count: 25    # Widely used in Spring Boot applications
            include_declaration: true
        tags: ["references", "dependency-injection", "spring-mvc", "enterprise"]
        timeout: 75s

      - id: "spring_ref_actuator_endpoints"
        name: "Spring Boot Actuator Endpoint References"
        method: "textDocument/references"
        file: "spring-boot-project/spring-boot-actuator/src/main/java/org/springframework/boot/actuate/health/HealthEndpoint.java"
        position:
          line: 70    # HealthEndpoint class
          character: 10
        params:
          includeDeclaration: false
        expected:
          success: true
          references:
            min_count: 15    # Health endpoint is referenced in multiple places
            include_declaration: false
        tags: ["references", "actuator", "monitoring", "enterprise"]
        timeout: 65s

      # Advanced Hover Tests - Enterprise Documentation
      - id: "spring_hover_reactive_streams"
        name: "Spring Reactive Streams Hover Documentation"
        method: "textDocument/hover"
        file: "spring-boot-project/spring-boot-autoconfigure/src/main/java/org/springframework/boot/autoconfigure/web/reactive/ReactiveWebServerFactoryAutoConfiguration.java"
        position:
          line: 80    # Reactive web configuration
          character: 25
        expected:
          success: true
          hover:
            has_content: true
            contains: ["Reactive", "WebServer", "AutoConfiguration", "reactive", "streams"]
            format: "markdown"
        tags: ["hover", "reactive", "streams", "enterprise", "documentation"]
        timeout: 55s

      - id: "spring_hover_metrics_integration"
        name: "Spring Boot Metrics Integration Hover"
        method: "textDocument/hover"
        file: "spring-boot-project/spring-boot-actuator/src/main/java/org/springframework/boot/actuate/metrics/MetricsEndpoint.java"
        position:
          line: 65    # Metrics endpoint with complex generic types
          character: 30
        expected:
          success: true
          hover:
            has_content: true
            contains: ["MetricsEndpoint", "metrics", "monitoring", "Micrometer"]
            format: "markdown"
        tags: ["hover", "metrics", "monitoring", "enterprise"]
        timeout: 50s

      # Document Symbols - Enterprise Class Analysis
      - id: "spring_docsym_auto_configuration_complex"
        name: "Spring AutoConfiguration Class Symbols"
        method: "textDocument/documentSymbol"
        file: "spring-boot-project/spring-boot-autoconfigure/src/main/java/org/springframework/boot/autoconfigure/web/servlet/WebMvcAutoConfiguration.java"
        expected:
          success: true
          symbols:
            min_count: 35    # Complex configuration class with many @Bean methods
            types: ["class", "method", "field", "annotation", "interface"]
        tags: ["symbols", "document", "spring-mvc", "auto-configuration", "enterprise"]
        timeout: 70s

      # Workspace Symbols - Enterprise Search
      - id: "spring_worksym_configuration_search"
        name: "Spring Configuration Classes Workspace Search"
        method: "workspace/symbol"
        params:
          query: "Configuration"
        expected:
          success: true
          symbols:
            min_count: 80    # Many configuration classes in Spring Boot
            types: ["class", "annotation"]
        tags: ["symbols", "workspace", "configuration", "enterprise"]
        timeout: 120s

  # Apache Kafka 3.6+ Enterprise Messaging Repository
  - name: "kafka-enterprise"
    path: "./tests/data/repositories/java/kafka"
    language: "java"
    description: "Apache Kafka 3.6+ streaming platform with enterprise messaging patterns"
    version_info:
      repository_url: "https://github.com/apache/kafka.git"
      commit_hash: "7fb6044b1a8b79a0b7d5e3f7e5c5f3e2b4f1c0a9"  # Kafka 3.6.1 release
      branch: "3.6"
      tag: "3.6.1"
    setup:
      commands:
        - "git fetch origin 3.6"
        - "git checkout 7fb6044b1a8b79a0b7d5e3f7e5c5f3e2b4f1c0a9"
        - "echo 'Building Apache Kafka with enterprise messaging features...'"
        - "./gradlew :clients:jar -x test --no-daemon"
        - "./gradlew :core:jar -x test --no-daemon"
        - "./gradlew :streams:jar -x test --no-daemon"
        - "./gradlew :connect:api:jar -x test --no-daemon"
        - "./gradlew jar -x test --no-daemon || true"
      timeout: 20m
      env:
        JAVA_HOME: "/usr/lib/jvm/java-17-openjdk"
        GRADLE_OPTS: "-Xmx4096m -XX:MaxMetaspaceSize=1024m -XX:+UseG1GC"
        GRADLE_USER_HOME: "./gradle-cache"
    validation:
      required_files:
        - "build.gradle"
        - "clients/src/main/java/org/apache/kafka/clients/producer/KafkaProducer.java"
        - "clients/src/main/java/org/apache/kafka/clients/consumer/KafkaConsumer.java"
        - "streams/src/main/java/org/apache/kafka/streams/KafkaStreams.java"
        - "core/src/main/scala/kafka/server/KafkaServer.scala"
    test_cases:
      # Advanced Definition Tests - Kafka Enterprise Patterns
      - id: "kafka_def_producer_enterprise"
        name: "Kafka Producer Enterprise Patterns Definition"
        method: "textDocument/definition"
        file: "clients/src/main/java/org/apache/kafka/clients/producer/KafkaProducer.java"
        position:
          line: 420   # send method with enterprise callback patterns
          character: 20
        expected:
          success: true
          definition:
            has_location: true
        tags: ["definition", "kafka", "producer", "enterprise", "messaging"]
        timeout: 65s

      - id: "kafka_def_streams_topology"
        name: "Kafka Streams Topology Definition"
        method: "textDocument/definition"
        file: "streams/src/main/java/org/apache/kafka/streams/StreamsBuilder.java"
        position:
          line: 180   # Topology builder patterns
          character: 25
        expected:
          success: true
          definition:
            has_location: true
            file_pattern: "**/Topology.java"
        tags: ["definition", "kafka-streams", "topology", "enterprise"]
        timeout: 60s

      # Advanced Reference Tests - Kafka Enterprise Usage
      - id: "kafka_ref_consumer_enterprise"
        name: "Kafka Consumer Enterprise Usage References"
        method: "textDocument/references"
        file: "clients/src/main/java/org/apache/kafka/clients/consumer/Consumer.java"
        position:
          line: 280   # poll method - core consumer API
          character: 15
        params:
          includeDeclaration: true
        expected:
          success: true
          references:
            min_count: 40   # poll() is widely used across Kafka ecosystem
            include_declaration: true
        tags: ["references", "kafka", "consumer", "enterprise", "polling"]
        timeout: 90s

      - id: "kafka_ref_serialization_framework"
        name: "Kafka Serialization Framework References"
        method: "textDocument/references"
        file: "clients/src/main/java/org/apache/kafka/common/serialization/Serializer.java"
        position:
          line: 45    # serialize method
          character: 20
        params:
          includeDeclaration: false
        expected:
          success: true
          references:
            min_count: 35   # Serialization is core to Kafka
            include_declaration: false
        tags: ["references", "kafka", "serialization", "enterprise"]
        timeout: 80s

      # Advanced Hover Tests - Kafka Enterprise Documentation
      - id: "kafka_hover_streams_dsl"
        name: "Kafka Streams DSL Hover Documentation"
        method: "textDocument/hover"
        file: "streams/src/main/java/org/apache/kafka/streams/kstream/KStream.java"
        position:
          line: 350   # DSL transformation methods
          character: 20
        expected:
          success: true
          hover:
            has_content: true
            contains: ["KStream", "transformation", "DSL", "stream", "processing"]
            format: "markdown"
        tags: ["hover", "kafka-streams", "dsl", "enterprise", "documentation"]
        timeout: 55s

      - id: "kafka_hover_admin_operations"
        name: "Kafka Admin Client Operations Hover"
        method: "textDocument/hover"
        file: "clients/src/main/java/org/apache/kafka/clients/admin/AdminClient.java"
        position:
          line: 250   # Admin operations with futures
          character: 30
        expected:
          success: true
          hover:
            has_content: true
            contains: ["AdminClient", "administration", "cluster", "management"]
            format: "markdown"
        tags: ["hover", "kafka", "admin", "enterprise", "operations"]
        timeout: 50s

      # Document Symbols - Kafka Enterprise Classes
      - id: "kafka_docsym_producer_complex"
        name: "Kafka Producer Complex Class Symbols"
        method: "textDocument/documentSymbol"
        file: "clients/src/main/java/org/apache/kafka/clients/producer/KafkaProducer.java"
        expected:
          success: true
          symbols:
            min_count: 40   # Producer has many methods and configuration options
            types: ["class", "method", "field", "constructor", "interface"]
        tags: ["symbols", "document", "kafka", "producer", "enterprise"]
        timeout: 75s

      # Workspace Symbols - Kafka Enterprise Search
      - id: "kafka_worksym_streams_search"
        name: "Kafka Streams Components Workspace Search"
        method: "workspace/symbol"
        params:
          query: "Stream"
        expected:
          success: true
          symbols:
            min_count: 50   # Many stream-related classes and interfaces
            types: ["class", "interface", "method"]
        tags: ["symbols", "workspace", "kafka-streams", "enterprise"]
        timeout: 100s

# Execution configuration optimized for enterprise codebases
execution:
  max_concurrency: 1        # Sequential execution for resource management
  default_timeout: 90s      # Increased timeout for complex enterprise codebases
  retry_attempts: 3
  retry_delay: 3s
  fail_fast: false
  randomize_order: false
  keep_servers_alive: true  # Optimize server reuse for performance

# Validation configuration for enterprise accuracy
validation:
  strict_mode: true         # Strict validation for enterprise testing
  validate_types: true
  validate_positions: true
  validate_uris: true
  validate_file_patterns: true
  enterprise_validation: true

# Reporting configuration for enterprise environments
reporting:
  formats: ["console", "json", "junit", "enterprise-summary"]
  output_dir: "enterprise-java-lsp-validation"
  verbose: true
  include_timing: true
  include_memory_usage: true
  include_server_performance: true
  save_detailed_logs: true
  enterprise_metrics: true

# Environment optimized for enterprise Java development
env:
  JAVA_HOME: "/usr/lib/jvm/java-17-openjdk"
  JAVA_OPTS: "-Xmx6144m -XX:MaxMetaspaceSize=1536m -XX:+UseG1GC -XX:G1HeapRegionSize=16m"
  GRADLE_OPTS: "-Xmx4096m -XX:MaxMetaspaceSize=1024m -XX:+UseG1GC"
  MAVEN_OPTS: "-Xmx4096m -XX:MaxMetaspaceSize=1024m -XX:+UseG1GC"
  LSP_JAVA_HEAP_SIZE: "4096m"
  LSP_JAVA_TIMEOUT_MULTIPLIER: "3"
  LSP_LOG_LEVEL: "INFO"