# Go Language Test Scenarios for LSP Gateway
# Simple, focused test cases using Kubernetes patterns

name: "Go LSP Scenarios"
description: "Simple Go language server testing scenarios"
language: "go"
tags: ["go", "kubernetes", "simple"]

# Test scenarios for Go using Kubernetes repository patterns
scenarios:
  # ===================
  # DEFINITION SCENARIOS
  # ===================
  
  - id: "go_def_interface_impl"
    name: "Go to Definition - Interface Implementation"
    description: "Navigate from interface method call to concrete implementation"
    method: "textDocument/definition"
    repository: "kubernetes"
    file: "pkg/api/v1/types.go"
    position: 
      line: 850  # Example: ObjectMeta field usage
      character: 15
    expected:
      success: true
      definition:
        has_location: true
        file_pattern: "vendor/k8s.io/apimachinery/pkg/apis/meta/v1/types.go"
    tags: ["definition", "interface", "kubernetes"]
  
  - id: "go_def_cross_package"
    name: "Go to Definition - Cross Package Function"
    description: "Navigate to function definition in different package"
    method: "textDocument/definition"
    repository: "kubernetes"
    file: "cmd/kubelet/app/server.go"
    position:
      line: 200  # Example: NewKubeletServer call
      character: 10
    expected:
      success: true
      definition:
        has_location: true
        file_pattern: "cmd/kubelet/app/server.go"
    tags: ["definition", "cross-package", "function"]
    
  - id: "go_def_struct_field"
    name: "Go to Definition - Struct Field"
    description: "Navigate to struct field definition"
    method: "textDocument/definition"
    repository: "kubernetes"
    file: "pkg/controller/deployment/deployment_controller.go"
    position:
      line: 100  # Example: accessing deployment spec
      character: 25
    expected:
      success: true
      definition:
        has_location: true
    tags: ["definition", "struct", "field"]

  # ===================
  # REFERENCES SCENARIOS  
  # ===================
  
  - id: "go_ref_interface_usage"
    name: "Find References - Interface Usage"
    description: "Find all usages of a Kubernetes interface"
    method: "textDocument/references"
    repository: "kubernetes"
    file: "pkg/api/v1/types.go"
    position:
      line: 100  # Example: Pod interface
      character: 10
    params:
      includeDeclaration: true
    expected:
      success: true
      references:
        min_count: 20  # Kubernetes Pod is widely used
        include_declaration: true
    tags: ["references", "interface", "kubernetes"]

  - id: "go_ref_struct_field_access"
    name: "Find References - Struct Field Access"
    description: "Find all references to a struct field"
    method: "textDocument/references"
    repository: "kubernetes"
    file: "pkg/api/v1/types.go"
    position:
      line: 600  # Example: ObjectMeta.Name field
      character: 8
    params:
      includeDeclaration: false
    expected:
      success: true
      references:
        min_count: 10
        include_declaration: false
    tags: ["references", "struct", "field"]

  - id: "go_ref_method_implementation"
    name: "Find References - Method Implementation"
    description: "Find all references to method implementations"
    method: "textDocument/references"
    repository: "kubernetes"
    file: "pkg/controller/controller_utils.go"
    position:
      line: 50
      character: 15
    params:
      includeDeclaration: true
    expected:
      success: true
      references:
        min_count: 5
        include_declaration: true
    tags: ["references", "method", "implementation"]

  # ===================
  # HOVER SCENARIOS
  # ===================
  
  - id: "go_hover_struct_type"
    name: "Hover - Struct Type Info"
    description: "Get hover information for struct type"
    method: "textDocument/hover"
    repository: "kubernetes"
    file: "pkg/api/v1/types.go"
    position:
      line: 800  # Example: Pod struct
      character: 10
    expected:
      success: true
      hover:
        has_content: true
        contains: ["Pod", "PodSpec", "ObjectMeta"]
        format: "markdown"
    tags: ["hover", "struct", "type"]

  - id: "go_hover_interface_method"
    name: "Hover - Interface Method"
    description: "Get hover info for interface method signature"
    method: "textDocument/hover"
    repository: "kubernetes"
    file: "pkg/kubelet/container/runtime.go"
    position:
      line: 100  # Example: Runtime interface method
      character: 20
    expected:
      success: true
      hover:
        has_content: true
        format: "markdown"
    tags: ["hover", "interface", "method"]

  - id: "go_hover_imported_package"
    name: "Hover - Imported Package"
    description: "Get hover info for imported package"
    method: "textDocument/hover"
    repository: "kubernetes"
    file: "cmd/kubelet/kubelet.go"
    position:
      line: 10  # Import statement
      character: 15
    expected:
      success: true
      hover:
        has_content: true
        format: "markdown"
    tags: ["hover", "import", "package"]

  # ===================
  # DOCUMENT SYMBOLS SCENARIOS
  # ===================
  
  - id: "go_docsym_controller_file"
    name: "Document Symbols - Kubernetes Controller"
    description: "Get all symbols from a Kubernetes controller file"
    method: "textDocument/documentSymbol"
    repository: "kubernetes"
    file: "pkg/controller/deployment/deployment_controller.go"
    position:
      line: 0
      character: 0
    expected:
      success: true
      symbols:
        min_count: 15  # Controller files have many structs and methods
        types: ["struct", "func", "var", "const"]
    tags: ["symbols", "document", "controller"]

  - id: "go_docsym_api_types"
    name: "Document Symbols - API Types"
    description: "Get symbols from Kubernetes API types file"
    method: "textDocument/documentSymbol"
    repository: "kubernetes"
    file: "pkg/api/v1/types.go"
    position:
      line: 0
      character: 0
    expected:
      success: true
      symbols:
        min_count: 50  # API types have many structs
        types: ["struct", "const", "var"]
    tags: ["symbols", "document", "api"]

  - id: "go_docsym_utility_package"
    name: "Document Symbols - Utility Package"
    description: "Get symbols from utility package"
    method: "textDocument/documentSymbol"
    repository: "kubernetes"
    file: "pkg/util/wait/wait.go"
    position:
      line: 0
      character: 0
    expected:
      success: true
      symbols:
        min_count: 10
        types: ["func", "struct", "var", "const"]
    tags: ["symbols", "document", "utility"]

  # ===================
  # WORKSPACE SYMBOLS SCENARIOS
  # ===================
  
  - id: "go_worksym_pod_search"
    name: "Workspace Symbol Search - Pod"
    description: "Search for Pod-related symbols across workspace"
    method: "workspace/symbol"
    repository: "kubernetes"
    query: "Pod"
    expected:
      success: true
      symbols:
        min_count: 30  # Pod is used extensively in Kubernetes
        types: ["struct", "func", "var"]
    tags: ["symbols", "workspace", "search"]

  - id: "go_worksym_controller_search"
    name: "Workspace Symbol Search - Controller"
    description: "Search for Controller symbols"
    method: "workspace/symbol"
    repository: "kubernetes"
    query: "Controller"
    expected:
      success: true
      symbols:
        min_count: 20
        types: ["struct", "func", "interface"]
    tags: ["symbols", "workspace", "controller"]

  - id: "go_worksym_interface_search"
    name: "Workspace Symbol Search - Interface"
    description: "Search for interface implementations"
    method: "workspace/symbol"
    repository: "kubernetes"
    query: "Runtime"
    expected:
      success: true
      symbols:
        min_count: 5
        types: ["interface", "struct", "func"]
    tags: ["symbols", "workspace", "interface"]

# Performance test cases
performance_tests:
  - id: "go_perf_large_file"
    name: "Performance - Large File Navigation"
    description: "Test performance on large Go files"
    method: "textDocument/definition"
    repository: "kubernetes"
    file: "pkg/api/v1/types.go"  # Large file with many types
    position:
      line: 1000
      character: 10
    timeout: "10s"
    expected:
      success: true
      definition:
        has_location: true
    tags: ["performance", "large-file"]

  - id: "go_perf_workspace_symbols"
    name: "Performance - Large Workspace Symbol Search"
    description: "Test workspace symbol search performance"
    method: "workspace/symbol"
    repository: "kubernetes"
    query: "Pod"  # Should match many Pod-related symbols
    timeout: "15s"
    expected:
      success: true
      symbols:
        min_count: 30
    tags: ["performance", "workspace", "large-result"]

# Test repository configuration
test_repositories:
  kubernetes:
    path: "./test-repositories/go/kubernetes"
    description: "Kubernetes container orchestration platform"
    setup:
      commands:
        - "go mod download"
        - "go build ./..."
      timeout: "15m"